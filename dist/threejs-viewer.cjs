"use strict";var ve=Object.defineProperty;var Pe=(l,e,t)=>e in l?ve(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var i=(l,e,t)=>Pe(l,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const xe=require("three"),he=require("three-stdlib"),_=require("react");function ye(l){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const t in l)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(l,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>l[t]})}}return e.default=l,Object.freeze(e)}const o=ye(xe);class de{constructor(){i(this,"_scene");i(this,"_isDisposed",!1);this._scene=new o.Scene}get scene(){return this._scene}add(e){if(this._isDisposed)throw new Error("SceneManager has been disposed");this._scene.add(e)}remove(e){if(this._isDisposed)throw new Error("SceneManager has been disposed");this._scene.remove(e)}clear(){if(this._isDisposed)throw new Error("SceneManager has been disposed");for(;this._scene.children.length>0;){const e=this._scene.children[0];e&&(this._disposeObject(e),this._scene.remove(e))}}dispose(){this._isDisposed||(this.clear(),this._scene.background&&(this._scene.background instanceof o.Texture&&this._scene.background.dispose(),this._scene.background=null),this._scene.environment&&(this._scene.environment.dispose(),this._scene.environment=null),this._isDisposed=!0)}_disposeObject(e){for(;e.children.length>0;){const t=e.children[0];t&&(this._disposeObject(t),e.remove(t))}e instanceof o.Mesh&&(e.geometry&&e.geometry.dispose(),e.material&&this._disposeMaterial(e.material)),(e instanceof o.Line||e instanceof o.Points)&&(e.geometry&&e.geometry.dispose(),e.material&&this._disposeMaterial(e.material))}_disposeMaterial(e){Array.isArray(e)?e.forEach(t=>this._disposeSingleMaterial(t)):this._disposeSingleMaterial(e)}_disposeSingleMaterial(e){["map","lightMap","bumpMap","normalMap","specularMap","envMap","alphaMap","aoMap","displacementMap","emissiveMap","gradientMap","metalnessMap","roughnessMap"].forEach(n=>{const r=e[n];r instanceof o.Texture&&r.dispose()}),e.dispose()}}const K={fov:75,near:.01,far:1e4,position:new o.Vector3(0,0,5)};class _e{constructor(e){i(this,"_camera");i(this,"_isDisposed",!1);const t=(e==null?void 0:e.fov)??K.fov,n=(e==null?void 0:e.near)??K.near,r=(e==null?void 0:e.far)??K.far,a=(e==null?void 0:e.position)??K.position.clone();this._camera=new o.PerspectiveCamera(t,1,n,r),this._camera.position.copy(a)}get camera(){return this._camera}configure(e){if(this._isDisposed)throw new Error("CameraManager has been disposed");e.fov!==void 0&&(this._camera.fov=e.fov),e.near!==void 0&&(this._camera.near=e.near),e.far!==void 0&&(this._camera.far=e.far),e.position!==void 0&&this._camera.position.copy(e.position),this._camera.updateProjectionMatrix()}setAspect(e){if(this._isDisposed)throw new Error("CameraManager has been disposed");(e<=0||!Number.isFinite(e))&&(console.warn("CameraManager: Invalid aspect ratio provided, using 1"),e=1),this._camera.aspect=e,this._camera.updateProjectionMatrix()}lookAt(e){if(this._isDisposed)throw new Error("CameraManager has been disposed");this._camera.lookAt(e)}dispose(){this._isDisposed||(this._isDisposed=!0)}}const se={antialias:!0,alpha:!1};class ce{constructor(){i(this,"_renderer",null);i(this,"_container",null);i(this,"_isDisposed",!1);i(this,"_isInitialized",!1)}get renderer(){if(!this._renderer)throw new Error("RenderManager has not been initialized. Call initialize() first.");return this._renderer}initialize(e,t){if(this._isDisposed)throw new Error("RenderManager has been disposed");if(this._isInitialized)throw new Error("RenderManager has already been initialized");const n=(t==null?void 0:t.antialias)??se.antialias,r=(t==null?void 0:t.alpha)??se.alpha;this._renderer=new o.WebGLRenderer({antialias:n,alpha:r}),this._renderer.setPixelRatio(window.devicePixelRatio);const a=e.clientWidth||1,u=e.clientHeight||1;this._renderer.setSize(a,u),e.appendChild(this._renderer.domElement),this._container=e,this._isInitialized=!0}setSize(e,t){if(this._isDisposed)throw new Error("RenderManager has been disposed");if(!this._renderer)throw new Error("RenderManager has not been initialized. Call initialize() first.");const n=Math.max(1,Math.floor(e)),r=Math.max(1,Math.floor(t));this._renderer.setSize(n,r)}render(e,t){if(this._isDisposed)throw new Error("RenderManager has been disposed");if(!this._renderer)throw new Error("RenderManager has not been initialized. Call initialize() first.");this._renderer.render(e,t)}dispose(){this._isDisposed||(this._renderer&&(this._container&&this._renderer.domElement.parentElement===this._container&&this._container.removeChild(this._renderer.domElement),this._renderer.dispose(),this._renderer=null),this._container=null,this._isInitialized=!1,this._isDisposed=!0)}}class ue{constructor(){i(this,"_plugins",new Map);i(this,"_context",null);i(this,"_isDisposed",!1)}setContext(e){if(this._isDisposed)throw new Error("PluginSystem has been disposed");this._context=e}getContext(){return this._context}register(e){if(this._isDisposed)throw new Error("PluginSystem has been disposed");if(!this._context)throw new Error("Plugin context has not been set. Call setContext() before registering plugins.");if(this._plugins.has(e.name))throw new Error(`Plugin "${e.name}" is already registered`);e.initialize(this._context),this._plugins.set(e.name,e)}unregister(e){if(this._isDisposed)throw new Error("PluginSystem has been disposed");const t=this._plugins.get(e);t&&(t.dispose(),this._plugins.delete(e))}get(e){return this._plugins.get(e)}has(e){return this._plugins.has(e)}getPluginNames(){return Array.from(this._plugins.keys())}get pluginCount(){return this._plugins.size}updateAll(e){if(this._isDisposed)throw new Error("PluginSystem has been disposed");for(const t of this._plugins.values())if(t.update)try{t.update(e)}catch(n){console.error(`Error updating plugin "${t.name}":`,n)}}disposeAll(){if(!this._isDisposed){for(const e of this._plugins.values())try{e.dispose()}catch(t){console.error(`Error disposing plugin "${e.name}":`,t)}this._plugins.clear(),this._context=null,this._isDisposed=!0}}}class pe{constructor(){i(this,"_sceneManager");i(this,"_cameraManager");i(this,"_renderManager");i(this,"_pluginSystem");i(this,"_container",null);i(this,"_isInitialized",!1);i(this,"_isRunning",!1);i(this,"_isDisposed",!1);i(this,"_animationFrameId",null);i(this,"_lastTime",0);i(this,"_renderLoop",()=>{if(!this._isRunning||this._isDisposed)return;const e=performance.now(),t=(e-this._lastTime)/1e3;this._lastTime=e,this._pluginSystem.updateAll(t),this._renderManager.render(this._sceneManager.scene,this._cameraManager.camera),this._animationFrameId=requestAnimationFrame(this._renderLoop)});this._sceneManager=new de,this._cameraManager=new _e,this._renderManager=new ce,this._pluginSystem=new ue}get scene(){return this._sceneManager}get camera(){return this._cameraManager}get renderer(){return this._renderManager}get plugins(){return this._pluginSystem}get isRunning(){return this._isRunning}get isInitialized(){return this._isInitialized}get container(){return this._container}initialize(e){if(this._isDisposed)throw new Error("ViewerCore has been disposed");if(this._isInitialized)throw new Error("ViewerCore has already been initialized");const{container:t,antialias:n,alpha:r,cameraConfig:a}=e;this._container=t,a&&this._cameraManager.configure(a);const u={};n!==void 0&&(u.antialias=n),r!==void 0&&(u.alpha=r),this._renderManager.initialize(t,u);const g=t.clientWidth||1,w=t.clientHeight||1;this._cameraManager.setAspect(g/w),this._setupDefaultLighting();const m={scene:this._sceneManager.scene,camera:this._cameraManager.camera,renderer:this._renderManager.renderer,container:t};this._pluginSystem.setContext(m),this._isInitialized=!0}start(){if(this._isDisposed)throw new Error("ViewerCore has been disposed");if(!this._isInitialized)throw new Error("ViewerCore has not been initialized. Call initialize() first.");this._isRunning||(this._isRunning=!0,this._lastTime=performance.now(),this._renderLoop())}stop(){if(this._isDisposed)throw new Error("ViewerCore has been disposed");this._isRunning=!1,this._animationFrameId!==null&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}resize(e,t){if(this._isDisposed)throw new Error("ViewerCore has been disposed");if(!this._isInitialized)throw new Error("ViewerCore has not been initialized. Call initialize() first.");const n=Math.max(1,e),r=Math.max(1,t);this._cameraManager.setAspect(n/r),this._renderManager.setSize(n,r)}dispose(){this._isDisposed||(this.stop(),this._pluginSystem.disposeAll(),this._renderManager.dispose(),this._sceneManager.dispose(),this._cameraManager.dispose(),this._container=null,this._isInitialized=!1,this._isDisposed=!0)}_setupDefaultLighting(){const e=this._sceneManager.scene,t=new o.AmbientLight(16777215,.5);e.add(t);const n=new o.DirectionalLight(16777215,1);n.position.set(5,10,7.5),e.add(n);const r=new o.DirectionalLight(16777215,.5);r.position.set(-5,5,-5),e.add(r);const a=new o.HemisphereLight(16777215,4473924,.5);a.position.set(0,20,0),e.add(a)}}class fe{constructor(){i(this,"name","ModelLoaderPlugin");i(this,"_context",null);i(this,"_loader");i(this,"_currentModel",null);i(this,"_boundingBox",null);i(this,"_center",null);i(this,"_loadingState",{isLoading:!1,progress:0,error:null});i(this,"_isDisposed",!1);i(this,"_loadRequestId",0);this._loader=new he.GLTFLoader}get loadingState(){return{...this._loadingState}}initialize(e){if(this._isDisposed)throw new Error("ModelLoaderPlugin has been disposed");this._context=e}async load(e){if(this._isDisposed)throw new Error("ModelLoaderPlugin has been disposed");if(!this._context)throw new Error("ModelLoaderPlugin has not been initialized. Call initialize() first.");this._currentModel&&this.unload();const t=++this._loadRequestId;this._loadingState={isLoading:!0,progress:0,error:null};try{const n=await this._loadGLTF(e);if(t!==this._loadRequestId)throw this._disposeObject(n.scene),new Error("Model loading cancelled due to new request");const r=n.scene;this._context.scene.add(r),this._currentModel=r;const a=new o.Box3().setFromObject(r),u=new o.Vector3;return a.getCenter(u),this._boundingBox=a,this._center=u,this._loadingState={isLoading:!1,progress:100,error:null},{model:r,boundingBox:a,center:u}}catch(n){if(t!==this._loadRequestId)throw n;const r=n instanceof Error?n:new Error(`Failed to load model from URL: ${e}`);throw this._loadingState={isLoading:!1,progress:0,error:r},r}}unload(){this._currentModel&&this._context&&(this._context.scene.remove(this._currentModel),this._disposeObject(this._currentModel),this._currentModel=null,this._boundingBox=null,this._center=null)}getCenter(){return this._center?this._center.clone():null}getBoundingBox(){return this._boundingBox?this._boundingBox.clone():null}dispose(){this._isDisposed||(this.unload(),this._context=null,this._isDisposed=!0)}_loadGLTF(e){return new Promise((t,n)=>{this._loader.load(e,r=>{t(r)},r=>{if(r.lengthComputable){const a=r.loaded/r.total*100;this._loadingState={...this._loadingState,progress:Math.round(a)}}},r=>{const a=r instanceof Error?r.message:`Failed to load model from URL: ${e}`;n(new Error(a))})})}_disposeObject(e){for(;e.children.length>0;){const t=e.children[0];t&&(this._disposeObject(t),e.remove(t))}e instanceof o.Mesh&&(e.geometry&&e.geometry.dispose(),e.material&&this._disposeMaterial(e.material)),(e instanceof o.Line||e instanceof o.Points)&&(e.geometry&&e.geometry.dispose(),e.material&&this._disposeMaterial(e.material)),e instanceof o.SkinnedMesh&&e.skeleton&&e.skeleton.dispose()}_disposeMaterial(e){Array.isArray(e)?e.forEach(t=>this._disposeSingleMaterial(t)):this._disposeSingleMaterial(e)}_disposeSingleMaterial(e){["map","lightMap","bumpMap","normalMap","specularMap","envMap","alphaMap","aoMap","displacementMap","emissiveMap","gradientMap","metalnessMap","roughnessMap","clearcoatMap","clearcoatNormalMap","clearcoatRoughnessMap","transmissionMap","thicknessMap","sheenColorMap","sheenRoughnessMap"].forEach(n=>{const r=e[n];r instanceof o.Texture&&r.dispose()}),e.dispose()}}class me{constructor(){i(this,"name","OrbitControlsPlugin");i(this,"_context",null);i(this,"_controls",null);i(this,"_isDisposed",!1);i(this,"_initialTarget",new o.Vector3(0,0,0));i(this,"_initialCameraPosition",new o.Vector3(0,0,5));i(this,"_initialMinDistance",.1);i(this,"_initialMaxDistance",1e4)}get controls(){if(!this._controls)throw new Error("OrbitControlsPlugin has not been initialized. Call initialize() first.");return this._controls}initialize(e){if(this._isDisposed)throw new Error("OrbitControlsPlugin has been disposed");this._context=e,this._controls=new he.OrbitControls(e.camera,e.container),this._initialCameraPosition.copy(e.camera.position),this._controls.minDistance=this._initialMinDistance,this._controls.maxDistance=this._initialMaxDistance,this._controls.enableDamping=!0,this._controls.dampingFactor=.05,this._controls.enablePan=!0,this._controls.enableRotate=!0,this._controls.enableZoom=!0}configure(e){if(this._isDisposed)throw new Error("OrbitControlsPlugin has been disposed");if(!this._controls)throw new Error("OrbitControlsPlugin has not been initialized. Call initialize() first.");e.target!==void 0&&(this._controls.target.copy(e.target),this._initialTarget.copy(e.target)),e.minDistance!==void 0&&(this._controls.minDistance=e.minDistance,this._initialMinDistance=e.minDistance),e.maxDistance!==void 0&&(this._controls.maxDistance=e.maxDistance,this._initialMaxDistance=e.maxDistance),e.enableDamping!==void 0&&(this._controls.enableDamping=e.enableDamping),e.dampingFactor!==void 0&&(this._controls.dampingFactor=e.dampingFactor),e.enablePan!==void 0&&(this._controls.enablePan=e.enablePan),e.enableRotate!==void 0&&(this._controls.enableRotate=e.enableRotate),e.enableZoom!==void 0&&(this._controls.enableZoom=e.enableZoom),this._controls.update()}setTarget(e){if(this._isDisposed)throw new Error("OrbitControlsPlugin has been disposed");if(!this._controls)throw new Error("OrbitControlsPlugin has not been initialized. Call initialize() first.");this._controls.target.copy(e),this._initialTarget.copy(e),this._controls.update()}setZoomLimits(e,t){if(this._isDisposed)throw new Error("OrbitControlsPlugin has been disposed");if(!this._controls)throw new Error("OrbitControlsPlugin has not been initialized. Call initialize() first.");if(e>t)throw new Error("Minimum zoom distance cannot be greater than maximum zoom distance");if(e<0)throw new Error("Minimum zoom distance cannot be negative");this._controls.minDistance=e,this._controls.maxDistance=t,this._initialMinDistance=e,this._initialMaxDistance=t,this._controls.update()}reset(){if(this._isDisposed)throw new Error("OrbitControlsPlugin has been disposed");if(!this._controls||!this._context)throw new Error("OrbitControlsPlugin has not been initialized. Call initialize() first.");this._controls.target.copy(this._initialTarget),this._context.camera.position.copy(this._initialCameraPosition),this._controls.minDistance=this._initialMinDistance,this._controls.maxDistance=this._initialMaxDistance,this._controls.update()}update(e){this._isDisposed||!this._controls||this._controls.update()}dispose(){this._isDisposed||(this._controls&&(this._controls.dispose(),this._controls=null),this._context=null,this._isDisposed=!0)}}class ge{constructor(){i(this,"name","GridHelperPlugin");i(this,"_context",null);i(this,"_gridHelper",null);i(this,"_axesHelper",null);i(this,"_isDisposed",!1);i(this,"_config",{size:10,divisions:10,colorCenterLine:4473924,colorGrid:8947848,plane:"XZ",showAxes:!0,axesSize:5})}initialize(e){if(this._isDisposed)throw new Error("GridHelperPlugin has been disposed");this._context=e,this._createGrid(),this._createAxes()}_createGrid(){this._context&&(this._gridHelper&&(this._context.scene.remove(this._gridHelper),this._disposeHelper(this._gridHelper)),this._gridHelper=new o.GridHelper(this._config.size,this._config.divisions,this._config.colorCenterLine,this._config.colorGrid),this._applyPlaneRotation(),this._context.scene.add(this._gridHelper))}_createAxes(){this._context&&(this._axesHelper&&(this._context.scene.remove(this._axesHelper),this._disposeHelper(this._axesHelper)),this._config.showAxes&&(this._axesHelper=new o.AxesHelper(this._config.axesSize),this._context.scene.add(this._axesHelper)))}_disposeHelper(e){if(!e)return;const t=e;if(t.geometry&&t.geometry.dispose(),t.material){const n=t.material;Array.isArray(n)?n.forEach(r=>r.dispose()):n.dispose()}}_applyPlaneRotation(){if(this._gridHelper)switch(this._gridHelper.rotation.set(0,0,0),this._config.plane){case"XY":this._gridHelper.rotation.x=Math.PI/2;break;case"YZ":this._gridHelper.rotation.z=Math.PI/2;break}}configure(e){if(this._isDisposed)throw new Error("GridHelperPlugin has been disposed");e.size!==void 0&&(this._config.size=e.size),e.divisions!==void 0&&(this._config.divisions=e.divisions),e.colorCenterLine!==void 0&&(this._config.colorCenterLine=e.colorCenterLine),e.colorGrid!==void 0&&(this._config.colorGrid=e.colorGrid),e.plane!==void 0&&(this._config.plane=e.plane),e.showAxes!==void 0&&(this._config.showAxes=e.showAxes),e.axesSize!==void 0&&(this._config.axesSize=e.axesSize),this._createGrid(),this._createAxes()}setVisible(e){this._gridHelper&&(this._gridHelper.visible=e)}setPlane(e){this._config.plane=e,this._applyPlaneRotation()}setAxesVisible(e){this._config.showAxes=e,this._createAxes()}dispose(){this._isDisposed||(this._gridHelper&&this._context&&(this._context.scene.remove(this._gridHelper),this._disposeHelper(this._gridHelper),this._gridHelper=null),this._axesHelper&&this._context&&(this._context.scene.remove(this._axesHelper),this._disposeHelper(this._axesHelper),this._axesHelper=null),this._context=null,this._isDisposed=!0)}}const re={KeyW:"forward",KeyS:"backward",KeyA:"left",KeyD:"right",ShiftLeft:"up",ShiftRight:"up",ControlLeft:"down",ControlRight:"down"};function Z(){return{forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1}}const Ee=5,De=!0;class Ce{constructor(){i(this,"name","CameraMovementPlugin");i(this,"_context",null);i(this,"_enabled",De);i(this,"_moveSpeed",Ee);i(this,"_flyMode",!1);i(this,"_movementState",Z());i(this,"_isDisposed",!1);i(this,"_boundHandleKeyDown",null);i(this,"_boundHandleKeyUp",null);i(this,"_orbitControlsTarget",null);i(this,"_tempMovement",new o.Vector3);i(this,"_tempForward",new o.Vector3);i(this,"_tempRight",new o.Vector3);i(this,"_tempWorldUp",new o.Vector3(0,1,0));i(this,"_tempCameraUp",new o.Vector3(0,1,0))}initialize(e){if(this._isDisposed)throw new Error("CameraMovementPlugin has been disposed");this._context=e,this._movementState=Z(),this._boundHandleKeyDown=this.handleKeyDown.bind(this),this._boundHandleKeyUp=this.handleKeyUp.bind(this),window.addEventListener("keydown",this._boundHandleKeyDown),window.addEventListener("keyup",this._boundHandleKeyUp)}update(e){if(this._isDisposed||!this._context||!this._enabled||!this.isMoving())return;const t=this._context.camera;if(!t)return;const n=this.calculateMovementVector(t);if(n.lengthSq()===0)return;const r=this._moveSpeed*e,a=n.multiplyScalar(r);t.position.add(a),this._orbitControlsTarget&&this._orbitControlsTarget.add(a)}dispose(){this._isDisposed||(this._boundHandleKeyDown&&(window.removeEventListener("keydown",this._boundHandleKeyDown),this._boundHandleKeyDown=null),this._boundHandleKeyUp&&(window.removeEventListener("keyup",this._boundHandleKeyUp),this._boundHandleKeyUp=null),this._movementState=Z(),this._context=null,this._isDisposed=!0)}configure(e){if(this._isDisposed)throw new Error("CameraMovementPlugin has been disposed");e.enabled!==void 0&&(this._enabled=e.enabled),e.moveSpeed!==void 0&&this.setMoveSpeed(e.moveSpeed),e.flyMode!==void 0&&this.setFlyMode(e.flyMode),e.orbitControlsTarget!==void 0&&(this._orbitControlsTarget=e.orbitControlsTarget)}setOrbitControlsTarget(e){this._orbitControlsTarget=e}setFlyMode(e){this._flyMode=e}isFlyMode(){return this._flyMode}setEnabled(e){if(this._isDisposed)throw new Error("CameraMovementPlugin has been disposed");this._enabled=e,e||(this._movementState=Z())}isEnabled(){return this._enabled}setMoveSpeed(e){if(this._isDisposed)throw new Error("CameraMovementPlugin has been disposed");this._moveSpeed=Math.abs(e)}getMoveSpeed(){return this._moveSpeed}isMoving(){return this._movementState.forward||this._movementState.backward||this._movementState.left||this._movementState.right||this._movementState.up||this._movementState.down}getMovementState(){return{...this._movementState}}setMovementState(e){this._movementState={...this._movementState,...e}}getContext(){return this._context}isDisposed(){return this._isDisposed}calculateMovementVector(e){if(this._tempMovement.set(0,0,0),!this.isMoving())return this._tempMovement;const t=this._tempForward;if(e.getWorldDirection(t),!this._flyMode&&(t.y=0,t.lengthSq()<1e-4)){const r=this._tempCameraUp.set(0,1,0);r.applyQuaternion(e.quaternion),t.set(r.x,0,r.z)}t.lengthSq()>0&&t.normalize();const n=this._tempRight;if(this._flyMode)n.set(1,0,0).applyQuaternion(e.quaternion);else{const r=this._tempWorldUp;n.crossVectors(t,r)}return n.lengthSq()>0&&n.normalize(),this._movementState.forward&&this._tempMovement.add(t),this._movementState.backward&&this._tempMovement.sub(t),this._movementState.right&&this._tempMovement.add(n),this._movementState.left&&this._tempMovement.sub(n),this._movementState.up&&(this._tempMovement.y+=1),this._movementState.down&&(this._tempMovement.y-=1),this._tempMovement.lengthSq()>0&&this._tempMovement.normalize(),this._tempMovement}handleKeyDown(e){if(!this._enabled||this._isDisposed)return;const t=re[e.code];t!==void 0&&this.updateMovementStateByDirection(t,!0)}handleKeyUp(e){if(this._isDisposed)return;const t=re[e.code];t!==void 0&&this.updateMovementStateByDirection(t,!1)}updateMovementStateByDirection(e,t){switch(e){case"forward":this._movementState.forward=t;break;case"backward":this._movementState.backward=t;break;case"left":this._movementState.left=t;break;case"right":this._movementState.right=t;break;case"up":this._movementState.up=t;break;case"down":this._movementState.down=t;break}}}class Se{constructor(){i(this,"name","CameraPathAnimationPlugin");i(this,"_context",null);i(this,"_curve",null);i(this,"_progress",0);i(this,"_isPlaying",!1);i(this,"_isDisposed",!1);i(this,"_duration",10);i(this,"_loop",!1);i(this,"_easeInOut",0);i(this,"_target",null);i(this,"_fixedDirection",null);i(this,"_lookAlongPath",!1);i(this,"_orbitControlsPlugin",null);i(this,"_wasOrbitControlsEnabled",!0);i(this,"_tempPos",new o.Vector3);i(this,"_tempLookAt",new o.Vector3)}initialize(e){if(this._isDisposed)throw new Error("CameraPathAnimationPlugin has been disposed");this._context=e}configure(e){this._isDisposed||(e.pathPoints&&e.pathPoints.length>=2&&(this._curve=new o.CatmullRomCurve3(e.pathPoints)),e.duration!==void 0&&e.duration>0&&(this._duration=e.duration),e.loop!==void 0&&(this._loop=e.loop),e.easeInOut!==void 0&&Number.isFinite(e.easeInOut)&&(this._easeInOut=Math.max(0,Math.min(1,e.easeInOut))),e.target!==void 0?(this._target=e.target,this._fixedDirection=null,this._lookAlongPath=!1):e.fixedDirection!==void 0?(this._fixedDirection=e.fixedDirection.clone().normalize(),this._target=null,this._lookAlongPath=!1):e.lookAlongPath!==void 0&&(this._lookAlongPath=e.lookAlongPath,this._lookAlongPath&&(this._target=null,this._fixedDirection=null)),e.autoPlay&&this.play())}play(){this._isDisposed||!this._curve||!this._context||this._isPlaying||(this._isPlaying=!0,this._orbitControlsPlugin&&(this._wasOrbitControlsEnabled=this._orbitControlsPlugin.controls.enabled,this._orbitControlsPlugin.controls.enabled=!1))}pause(){this._isPlaying&&(this._isPlaying=!1,this._orbitControlsPlugin&&(this._orbitControlsPlugin.controls.enabled=this._wasOrbitControlsEnabled))}stop(){this.pause(),this._progress=0}update(e){if(!this._isPlaying||!this._curve||!this._context)return;this._progress+=e/this._duration,this._progress>=1&&(this._loop?this._progress%=1:(this._progress=1,this.pause()));const t=this._context.camera,n=this._applyEaseInOut(this._progress);if(this._curve.getPointAt(n,this._tempPos),t.position.copy(this._tempPos),this._target)this._target instanceof o.Object3D?(this._target.getWorldPosition(this._tempLookAt),t.lookAt(this._tempLookAt)):t.lookAt(this._target);else if(this._fixedDirection)this._tempLookAt.copy(t.position).add(this._fixedDirection),t.lookAt(this._tempLookAt);else if(this._lookAlongPath){const r=Math.min(n+.01,1);this._curve.getPointAt(r,this._tempLookAt),t.lookAt(this._tempLookAt)}}dispose(){this._isDisposed||(this.stop(),this._curve=null,this._context=null,this._target=null,this._easeInOut=0,this._orbitControlsPlugin=null,this._isDisposed=!0)}setOrbitControlsPlugin(e){this._orbitControlsPlugin=e}_applyEaseInOut(e){if(this._easeInOut<=0)return e;const t=e*e*(3-2*e);return e+(t-e)*this._easeInOut}}class Te{constructor(){i(this,"name","CameraPathDesignerPlugin");i(this,"_context",null);i(this,"_isDisposed",!1);i(this,"_enabled",!1);i(this,"_orbitControlsPlugin",null);i(this,"_wasOrbitControlsEnabled",!0);i(this,"_duration",10);i(this,"_loop",!1);i(this,"_easeInOut",0);i(this,"_pathPoints",[]);i(this,"_target",null);i(this,"_selectedIndex",null);i(this,"_draggingIndex",null);i(this,"_pickTargetArmed",!1);i(this,"_raycaster",new o.Raycaster);i(this,"_pointerNdc",new o.Vector2);i(this,"_dragPlane",new o.Plane);i(this,"_tempNormal",new o.Vector3);i(this,"_tempPoint",new o.Vector3);i(this,"_helpersGroup",null);i(this,"_pointMeshes",[]);i(this,"_pointGeometry",null);i(this,"_pointMaterial",null);i(this,"_selectedPointMaterial",null);i(this,"_targetMesh",null);i(this,"_targetGeometry",null);i(this,"_targetMaterial",null);i(this,"_line",null);i(this,"_lineGeometry",null);i(this,"_lineMaterial",null);i(this,"_samples",200);i(this,"_pointSize",.12);i(this,"_lineColor",4500223);i(this,"_pointColor",16777215);i(this,"_selectedPointColor",16763972);i(this,"_targetColor",16729190);i(this,"_onPointerDown",e=>{var v;if(!this._context||!this._enabled||this._isDisposed)return;const t=this._context.renderer.domElement,n=t.getBoundingClientRect(),r=(e.clientX-n.left)/n.width*2-1,a=-((e.clientY-n.top)/n.height*2-1);if(this._pointerNdc.set(r,a),this._raycaster.setFromCamera(this._pointerNdc,this._context.camera),this._pickTargetArmed){const O=this._raycaster.intersectObjects(this._context.scene.children,!0).find(R=>!this._isHelperObject(R.object));O&&this.setTargetPoint(O.point),this._pickTargetArmed=!1;return}const g=this._raycaster.intersectObjects(this._pointMeshes,!1)[0];if(!g){this.setSelectedIndex(null);return}const w=(v=g.object.userData)==null?void 0:v.pathPointIndex;if(typeof w!="number")return;const m=this._pathPoints[w];m&&(this.setSelectedIndex(w),this._draggingIndex=w,this._context.camera.getWorldDirection(this._tempNormal).normalize(),this._dragPlane.setFromNormalAndCoplanarPoint(this._tempNormal,m),this._orbitControlsPlugin&&(this._wasOrbitControlsEnabled=this._orbitControlsPlugin.controls.enabled,this._orbitControlsPlugin.controls.enabled=!1),t.setPointerCapture(e.pointerId))});i(this,"_onPointerMove",e=>{if(!this._context||!this._enabled||this._isDisposed||this._draggingIndex===null)return;const n=this._context.renderer.domElement.getBoundingClientRect(),r=(e.clientX-n.left)/n.width*2-1,a=-((e.clientY-n.top)/n.height*2-1);if(this._pointerNdc.set(r,a),this._raycaster.setFromCamera(this._pointerNdc,this._context.camera),!this._raycaster.ray.intersectPlane(this._dragPlane,this._tempPoint))return;const w=this._pathPoints[this._draggingIndex];w&&(w.copy(this._tempPoint),this._syncHelpers())});i(this,"_onPointerUp",e=>{if(!(!this._context||this._isDisposed)){this._draggingIndex!==null&&this._orbitControlsPlugin&&(this._orbitControlsPlugin.controls.enabled=this._wasOrbitControlsEnabled),this._draggingIndex=null;try{this._context.renderer.domElement.releasePointerCapture(e.pointerId)}catch{}}})}initialize(e){if(this._isDisposed)throw new Error("CameraPathDesignerPlugin has been disposed");this._context=e,this._ensureHelpers()}configure(e){this._isDisposed||(e.pointSize!==void 0&&e.pointSize>0&&(this._pointSize=e.pointSize),e.lineColor!==void 0&&(this._lineColor=e.lineColor),e.pointColor!==void 0&&(this._pointColor=e.pointColor),e.selectedPointColor!==void 0&&(this._selectedPointColor=e.selectedPointColor),e.targetColor!==void 0&&(this._targetColor=e.targetColor),e.samples!==void 0&&e.samples>=10&&(this._samples=e.samples),this._rebuildMaterials(),this._syncHelpers(),e.enabled!==void 0&&(e.enabled?this.enable():this.disable()))}enable(){if(!this._context||this._isDisposed||this._enabled)return;this._enabled=!0,this._ensureHelpers(),this._helpersGroup&&(this._helpersGroup.visible=!0);const e=this._context.renderer.domElement;e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerMove),e.addEventListener("pointerup",this._onPointerUp)}disable(){if(!this._context||this._isDisposed||!this._enabled)return;this._enabled=!1,this._pickTargetArmed=!1,this._draggingIndex=null;const e=this._context.renderer.domElement;e.removeEventListener("pointerdown",this._onPointerDown),e.removeEventListener("pointermove",this._onPointerMove),e.removeEventListener("pointerup",this._onPointerUp),this._helpersGroup&&(this._helpersGroup.visible=!1),this._orbitControlsPlugin&&(this._orbitControlsPlugin.controls.enabled=this._wasOrbitControlsEnabled)}isEnabled(){return this._enabled}setOrbitControlsPlugin(e){this._orbitControlsPlugin=e}setDuration(e){Number.isFinite(e)&&e>0&&(this._duration=e)}getDuration(){return this._duration}setLoop(e){this._loop=e}getLoop(){return this._loop}setEaseInOut(e){Number.isFinite(e)&&(this._easeInOut=Math.max(0,Math.min(1,e)))}getEaseInOut(){return this._easeInOut}getPathPoints(){return this._pathPoints.map(e=>e.clone())}setPathPoints(e){this._pathPoints=e.map(t=>t.clone()),this.setSelectedIndex(null),this._ensureHelpers(),this._syncHelpers()}addPoint(e){this._pathPoints.push(e.clone()),this._ensureHelpers(),this._syncHelpers(),this.setSelectedIndex(this._pathPoints.length-1)}addPointFromCamera(){this._context&&this.addPoint(this._context.camera.position)}insertPointAfter(e){if(!this._context||e<0||e>=this._pathPoints.length)return;const t=this._pathPoints[e];if(!t)return;const n=new o.Vector3(1,0,0).applyQuaternion(this._context.camera.quaternion).normalize(),r=t.clone().addScaledVector(n,this._pointSize*6);this._pathPoints.splice(e+1,0,r),this._ensureHelpers(),this._syncHelpers(),this.setSelectedIndex(e+1)}removePoint(e){e<0||e>=this._pathPoints.length||(this._pathPoints.splice(e,1),this._selectedIndex!==null&&(this._pathPoints.length===0?this._selectedIndex=null:this._selectedIndex=Math.min(this._selectedIndex,this._pathPoints.length-1)),this._ensureHelpers(),this._syncHelpers())}removeSelectedPoint(){this._selectedIndex!==null&&this.removePoint(this._selectedIndex)}clear(){this._pathPoints=[],this._selectedIndex=null,this._ensureHelpers(),this._syncHelpers()}setSelectedIndex(e){if(e===null){this._selectedIndex=null,this._syncPointMaterials();return}e<0||e>=this._pathPoints.length||(this._selectedIndex=e,this._syncPointMaterials())}getSelectedIndex(){return this._selectedIndex}armPickTargetOnce(){this._enabled||this.enable(),this._pickTargetArmed=!0}isPickTargetArmed(){return this._pickTargetArmed}setTargetPoint(e){this._target={type:"point",point:e.clone()},this._syncHelpers()}setTargetObject(e){this._target={type:"object",object:e},this._syncHelpers()}clearTarget(){this._target=null,this._syncHelpers()}getTargetPoint(){return this._target?this._target.type==="point"?this._target.point.clone():(this._target.object.getWorldPosition(this._tempPoint),this._tempPoint.clone()):null}exportShot(){return{duration:this._duration,loop:this._loop,easeInOut:this._easeInOut,pathPoints:this._pathPoints.map(e=>({x:e.x,y:e.y,z:e.z})),target:this.getTargetPoint()?(()=>{const e=this.getTargetPoint();return{x:e.x,y:e.y,z:e.z}})():null}}importShot(e){this.setDuration(e.duration),this.setLoop(e.loop),this.setEaseInOut(e.easeInOut),this.setPathPoints(e.pathPoints.map(t=>new o.Vector3(t.x,t.y,t.z))),e.target?this.setTargetPoint(new o.Vector3(e.target.x,e.target.y,e.target.z)):this.clearTarget()}dispose(){var e,t,n,r,a,u,g;this._isDisposed||(this.disable(),this._isDisposed=!0,this._helpersGroup&&this._context&&this._context.scene.remove(this._helpersGroup),this._pointMeshes=[],(e=this._pointGeometry)==null||e.dispose(),(t=this._pointMaterial)==null||t.dispose(),(n=this._selectedPointMaterial)==null||n.dispose(),(r=this._targetGeometry)==null||r.dispose(),(a=this._targetMaterial)==null||a.dispose(),(u=this._lineGeometry)==null||u.dispose(),(g=this._lineMaterial)==null||g.dispose(),this._helpersGroup=null,this._pointGeometry=null,this._pointMaterial=null,this._selectedPointMaterial=null,this._targetMesh=null,this._targetGeometry=null,this._targetMaterial=null,this._line=null,this._lineGeometry=null,this._lineMaterial=null,this._context=null,this._orbitControlsPlugin=null,this._target=null)}_ensureHelpers(){if(this._context){for(this._helpersGroup||(this._helpersGroup=new o.Group,this._helpersGroup.name="CameraPathDesignerHelpers",this._helpersGroup.visible=this._enabled,this._context.scene.add(this._helpersGroup)),this._pointGeometry||(this._pointGeometry=new o.SphereGeometry(this._pointSize,16,12)),this._lineMaterial||(this._lineMaterial=new o.LineBasicMaterial({color:this._lineColor})),this._targetGeometry||(this._targetGeometry=new o.SphereGeometry(this._pointSize*1.2,16,12)),this._targetMaterial||(this._targetMaterial=new o.MeshBasicMaterial({color:this._targetColor})),(!this._pointMaterial||!this._selectedPointMaterial)&&this._rebuildMaterials(),this._lineGeometry||(this._lineGeometry=new o.BufferGeometry),this._line||(this._line=new o.Line(this._lineGeometry,this._lineMaterial),this._line.renderOrder=9999,this._helpersGroup.add(this._line)),this._targetMesh||(this._targetMesh=new o.Mesh(this._targetGeometry,this._targetMaterial),this._targetMesh.visible=!1,this._targetMesh.renderOrder=1e4,this._helpersGroup.add(this._targetMesh));this._pointMeshes.length<this._pathPoints.length;){const e=new o.Mesh(this._pointGeometry,this._pointMaterial);e.userData={pathPointIndex:this._pointMeshes.length},e.renderOrder=1e4,this._pointMeshes.push(e),this._helpersGroup.add(e)}for(;this._pointMeshes.length>this._pathPoints.length;){const e=this._pointMeshes.pop();this._helpersGroup.remove(e)}for(let e=0;e<this._pointMeshes.length;e++){const t=this._pointMeshes[e];t&&(t.userData.pathPointIndex=e)}}}_rebuildMaterials(){var e,t,n,r;(e=this._pointMaterial)==null||e.dispose(),(t=this._selectedPointMaterial)==null||t.dispose(),(n=this._lineMaterial)==null||n.dispose(),(r=this._targetMaterial)==null||r.dispose(),this._pointMaterial=new o.MeshBasicMaterial({color:this._pointColor}),this._selectedPointMaterial=new o.MeshBasicMaterial({color:this._selectedPointColor}),this._lineMaterial=new o.LineBasicMaterial({color:this._lineColor}),this._targetMaterial=new o.MeshBasicMaterial({color:this._targetColor}),this._line&&(this._line.material=this._lineMaterial),this._targetMesh&&(this._targetMesh.material=this._targetMaterial),this._syncPointMaterials()}_syncPointMaterials(){if(!(!this._pointMaterial||!this._selectedPointMaterial))for(let e=0;e<this._pointMeshes.length;e++){const t=this._pointMeshes[e];t&&(t.material=e===this._selectedIndex?this._selectedPointMaterial:this._pointMaterial)}}_syncHelpers(){if(!(!this._context||!this._helpersGroup)){for(let e=0;e<this._pathPoints.length;e++){const t=this._pointMeshes[e],n=this._pathPoints[e];!t||!n||(t.position.copy(n),t.visible=this._enabled)}if(this._targetMesh){const e=this.getTargetPoint();e?(this._targetMesh.visible=this._enabled,this._targetMesh.position.copy(e)):this._targetMesh.visible=!1}this._syncLine(),this._syncPointMaterials()}}_syncLine(){if(!this._lineGeometry)return;if(this._pathPoints.length<2){this._lineGeometry.setAttribute("position",new o.Float32BufferAttribute([],3)),this._lineGeometry.computeBoundingSphere();return}const t=new o.CatmullRomCurve3(this._pathPoints).getPoints(this._samples),n=new Float32Array(t.length*3);for(let r=0;r<t.length;r++){const a=t[r];a&&(n[r*3+0]=a.x,n[r*3+1]=a.y,n[r*3+2]=a.z)}this._lineGeometry.setAttribute("position",new o.BufferAttribute(n,3)),this._lineGeometry.computeBoundingSphere()}_isHelperObject(e){return this._helpersGroup?e===this._helpersGroup?!0:this._helpersGroup.children.includes(e)||this._helpersGroup.getObjectById(e.id)!==void 0:!1}}var X={exports:{}},B={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne;function Re(){if(ne)return B;ne=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,a){var u=null;if(a!==void 0&&(u=""+a),r.key!==void 0&&(u=""+r.key),"key"in r){a={};for(var g in r)g!=="key"&&(a[g]=r[g])}else a=r;return r=a.ref,{$$typeof:l,type:n,key:u,ref:r!==void 0?r:null,props:a}}return B.Fragment=e,B.jsx=t,B.jsxs=t,B}var U={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oe;function Ae(){return oe||(oe=1,process.env.NODE_ENV!=="production"&&(function(){function l(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===J?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case z:return"Fragment";case G:return"Profiler";case I:return"StrictMode";case $:return"Suspense";case L:return"SuspenseList";case F:return"Activity"}if(typeof s=="object")switch(typeof s.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),s.$$typeof){case D:return"Portal";case Y:return s.displayName||"Context";case k:return(s._context.displayName||"Context")+".Consumer";case W:var h=s.render;return s=s.displayName,s||(s=h.displayName||h.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case V:return h=s.displayName||null,h!==null?h:l(s.type)||"Memo";case P:h=s._payload,s=s._init;try{return l(s(h))}catch{}}return null}function e(s){return""+s}function t(s){try{e(s);var h=!1}catch{h=!0}if(h){h=console;var p=h.error,f=typeof Symbol=="function"&&Symbol.toStringTag&&s[Symbol.toStringTag]||s.constructor.name||"Object";return p.call(h,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",f),e(s)}}function n(s){if(s===z)return"<>";if(typeof s=="object"&&s!==null&&s.$$typeof===P)return"<...>";try{var h=l(s);return h?"<"+h+">":"<...>"}catch{return"<...>"}}function r(){var s=d.A;return s===null?null:s.getOwner()}function a(){return Error("react-stack-top-frame")}function u(s){if(c.call(s,"key")){var h=Object.getOwnPropertyDescriptor(s,"key").get;if(h&&h.isReactWarning)return!1}return s.key!==void 0}function g(s,h){function p(){C||(C=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",h))}p.isReactWarning=!0,Object.defineProperty(s,"key",{get:p,configurable:!0})}function w(){var s=l(this.type);return M[s]||(M[s]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),s=this.props.ref,s!==void 0?s:null}function m(s,h,p,f,N,Q){var b=p.ref;return s={$$typeof:H,type:s,key:h,props:p,_owner:f},(b!==void 0?b:null)!==null?Object.defineProperty(s,"ref",{enumerable:!1,get:w}):Object.defineProperty(s,"ref",{enumerable:!1,value:null}),s._store={},Object.defineProperty(s._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(s,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(s,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:N}),Object.defineProperty(s,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Q}),Object.freeze&&(Object.freeze(s.props),Object.freeze(s)),s}function v(s,h,p,f,N,Q){var b=h.children;if(b!==void 0)if(f)if(x(b)){for(f=0;f<b.length;f++)A(b[f]);Object.freeze&&Object.freeze(b)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else A(b);if(c.call(h,"key")){b=l(s);var j=Object.keys(h).filter(function(Me){return Me!=="key"});f=0<j.length?"{key: someKey, "+j.join(": ..., ")+": ...}":"{key: someKey}",T[b+f]||(j=0<j.length?"{"+j.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,f,b,j,b),T[b+f]=!0)}if(b=null,p!==void 0&&(t(p),b=""+p),u(h)&&(t(h.key),b=""+h.key),"key"in h){p={};for(var ee in h)ee!=="key"&&(p[ee]=h[ee])}else p=h;return b&&g(p,typeof s=="function"?s.displayName||s.name||"Unknown":s),m(s,b,p,r(),N,Q)}function A(s){O(s)?s._store&&(s._store.validated=1):typeof s=="object"&&s!==null&&s.$$typeof===P&&(s._payload.status==="fulfilled"?O(s._payload.value)&&s._payload.value._store&&(s._payload.value._store.validated=1):s._store&&(s._store.validated=1))}function O(s){return typeof s=="object"&&s!==null&&s.$$typeof===H}var R=_,H=Symbol.for("react.transitional.element"),D=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),Y=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),J=Symbol.for("react.client.reference"),d=R.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,c=Object.prototype.hasOwnProperty,x=Array.isArray,y=console.createTask?console.createTask:function(){return null};R={react_stack_bottom_frame:function(s){return s()}};var C,M={},E=R.react_stack_bottom_frame.bind(R,a)(),S=y(n(a)),T={};U.Fragment=z,U.jsx=function(s,h,p){var f=1e4>d.recentlyCreatedOwnerStacks++;return v(s,h,p,!1,f?Error("react-stack-top-frame"):E,f?y(n(s)):S)},U.jsxs=function(s,h,p){var f=1e4>d.recentlyCreatedOwnerStacks++;return v(s,h,p,!0,f?Error("react-stack-top-frame"):E,f?y(n(s)):S)}})()),U}var ae;function Oe(){return ae||(ae=1,process.env.NODE_ENV==="production"?X.exports=Re():X.exports=Ae()),X.exports}var te=Oe();const ie=_.createContext(void 0);ie.displayName="ThreeInstanceContext";const q={scene:null,camera:null,renderer:null,container:null,isReady:!1,isDisposed:!1},ze={unmounted:["mounted"],mounted:["initialized","disposed"],initialized:["disposed"],disposed:[]},Ie={unmounted:!1,mounted:!1,initialized:!0,disposed:!1};function ke(l,e){return ze[l].includes(e)}function He(l,e){const t=Ie[e];return e==="disposed"?{...q,isDisposed:!0}:!t||!l||!l.isInitialized?q:{scene:l.scene.scene,camera:l.camera.camera,renderer:l.renderer.renderer,container:l.container,isReady:!0,isDisposed:!1}}function be({children:l,viewerCore:e}){const[t,n]=_.useState("unmounted"),r=_.useRef(!1),a=_.useRef(null),u=_.useCallback(m=>{n(v=>ke(v,m)?m:v)},[]);_.useEffect(()=>(r.current=!0,u("mounted"),()=>{r.current=!1,n(m=>m!=="disposed"?"disposed":m)}),[u]),_.useEffect(()=>{const m=a.current;if(a.current=e,m&&!e){u("disposed");return}e&&e.isInitialized&&u("initialized")},[e,u]);const g=_.useCallback(()=>{e&&e.isInitialized&&t==="mounted"&&u("initialized")},[e,t,u]);_.useEffect(()=>{if(!e||t!=="mounted")return;g();const m=setInterval(g,50),v=setTimeout(()=>{clearInterval(m)},5e3);return()=>{clearInterval(m),clearTimeout(v)}},[e,t,g]);const w=_.useMemo(()=>He(e,t),[e,t]);return te.jsx(ie.Provider,{value:w,children:l})}be.displayName="ThreeInstanceProvider";const le=5526612,we=_.forwardRef(function({modelUrl:e,pivotPoint:t,zoomLimits:n,grid:r,backgroundColor:a=le,className:u,style:g,onLoad:w,onError:m,onLoadingChange:v,onViewerReady:A,children:O},R){const H=_.useRef(null),D=_.useRef(null),z=_.useRef(null),I=_.useRef(null),G=_.useRef(null),[k,Y]=_.useState(!1),[W,$]=_.useState(null),L=_.useRef(w),V=_.useRef(m),P=_.useRef(v),F=_.useRef(A);_.useEffect(()=>{L.current=w},[w]),_.useEffect(()=>{V.current=m},[m]),_.useEffect(()=>{P.current=v},[v]),_.useEffect(()=>{F.current=A},[A]),_.useImperativeHandle(R,()=>({getInstances(){if(k)return{...q,isDisposed:!0};const d=D.current;return!d||!d.isInitialized?q:{scene:d.scene.scene,camera:d.camera.camera,renderer:d.renderer.renderer,container:d.container,isReady:!0,isDisposed:!1}},getViewerCore(){return k?null:D.current},isReady(){if(k)return!1;const d=D.current;return d!==null&&d.isInitialized},isDisposed(){return k}}),[k]),_.useEffect(()=>{var M;const d=H.current;if(!d)return;const c=new pe;c.initialize({container:d,antialias:!0,alpha:!0});const x=new fe,y=new me,C=new ge;c.plugins.register(x),c.plugins.register(y),c.plugins.register(C),D.current=c,z.current=x,I.current=y,G.current=C,$(c),Y(!1);try{(M=F.current)==null||M.call(F,c)}catch(E){console.error("onViewerReady callback failed:",E)}return c.start(),()=>{c.dispose(),D.current=null,z.current=null,I.current=null,G.current=null,$(null),Y(!0)}},[]),_.useEffect(()=>{const d=H.current,c=D.current;if(!d||!c)return;const x=new ResizeObserver(y=>{for(const C of y){const{width:M,height:E}=C.contentRect;M>0&&E>0&&c.resize(M,E)}});return x.observe(d),()=>{x.disconnect()}},[]),_.useEffect(()=>{var C;const d=z.current,c=I.current,x=G.current;if(!d)return;if(!e){d.unload();return}let y=!1;return(C=P.current)==null||C.call(P,!0),d.load(e).then(M=>{var s,h,p;if(y)return;(s=P.current)==null||s.call(P,!1),c&&!t&&c.setTarget(M.center);const E=M.boundingBox,S=new o.Vector3;E.getSize(S);const T=Math.max(S.x,S.y,S.z);if(c&&!n){const f=((h=D.current)==null?void 0:h.camera.camera.far)??1e3,N=Math.min(T*10,f*.9);c.setZoomLimits(T*.1,N)}if(x&&(!r||r.size===void 0)){const f=T*3;x.configure({size:f,divisions:10,axesSize:T*1.5})}(p=L.current)==null||p.call(L,M)}).catch(M=>{var S,T;if(y)return;(S=P.current)==null||S.call(P,!1);const E=M instanceof Error?M:new Error(String(M));(T=V.current)==null||T.call(V,E)}),()=>{y=!0}},[e]),_.useEffect(()=>{const d=I.current;if(d&&t){const c=new o.Vector3(t.x,t.y,t.z);d.setTarget(c)}},[t]),_.useEffect(()=>{const d=I.current;if(d&&n){const c=n.min??.1,x=n.max??1e4;d.setZoomLimits(c,x)}},[n]),_.useEffect(()=>{const d=G.current;if(d)if(r){const c={};r.size!==void 0&&(c.size=r.size),r.divisions!==void 0&&(c.divisions=r.divisions),r.plane!==void 0&&(c.plane=r.plane),r.showAxes!==void 0&&(c.showAxes=r.showAxes),d.configure(c),d.setVisible(r.visible!==!1)}else d.setVisible(!1)},[r]),_.useEffect(()=>{const d=D.current;if(!d||!d.isInitialized)return;const c=d.scene.scene;a!==void 0?c.background=new o.Color(a):c.background=new o.Color(le)},[a,W]);const J={width:"100%",height:"100%",...g};return te.jsxs(be,{viewerCore:W,children:[te.jsx("div",{ref:H,className:u,style:J}),O]})});we.displayName="ThreeViewer";function Ge(){const l=_.useContext(ie);if(l===void 0)throw new Error("useThreeInstance must be used within a ThreeViewer component. Make sure your component is a child of <ThreeViewer>.");return l}exports.CameraManager=_e;exports.CameraMovementPlugin=Ce;exports.CameraPathAnimationPlugin=Se;exports.CameraPathDesignerPlugin=Te;exports.GridHelperPlugin=ge;exports.ModelLoaderPlugin=fe;exports.OrbitControlsPlugin=me;exports.PluginSystem=ue;exports.RenderManager=ce;exports.SceneManager=de;exports.ThreeViewer=we;exports.ViewerCore=pe;exports.useThreeInstance=Ge;
//# sourceMappingURL=threejs-viewer.cjs.map
